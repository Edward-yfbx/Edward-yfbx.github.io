---
layout:     post
title:      从零开始写接口(三)
subtitle:   接口实例
date:       2018-09-21
author:     Edward
header-img: img/post-bg-coffee.jpeg
---

#### 1. 项目创建完成后，会自动生成Application类并创建程序入口
```
@SpringBootApplication
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

#### 2. 根据需求创建自及的接口类(Controller),如写一个登录接口:
```
@Controller
public class UserCtrl {

    @RequestMapping(value = "/login", method = RequestMethod.POST)
    @ResponseBody
    public String login(String account, String password) {
        // TODO: 数据库查询以及逻辑操作
        return "登录成功";
    }
}
```
- 在类名上添加注解 `@Controller`
- GET,POST请求注解  `@RequestMapping(method = RequestMethod.POST)`
- 方法名注解 `@RequestMapping("/login")` 这个就是请求接口的方法名，如：htttp://localhost:8080/login
- 方法参数 `account, password` 就是接口参数  

这个接口只是返回了一个字符串"登录成功"，没有做任何操作，实际的接口应该是从数据库中查找数据，然后返回json  
#### 3. 连接数据库
```
 public static void exeQuery(String sql) {
        System.out.println(sql);
        try {
            // 注册 JDBC 驱动
            Class.forName("com.mysql.jdbc.Driver");
            // 打开链接
            Connection connection = DriverManager.getConnection(DB_URL, USER, PASS);
            Statement stmt = connection.createStatement();
            //执行查询语句
            ResultSet rs = stmt.executeQuery(sql);
            //TODO 遍历ResultSet得到结果
            
            //执行增删改语句,注意这个方法返回boolean值，并不是表示语句是否执行成功的，而是表示结果是否是ResultSet
            stmt.execute(sql);
            
            //关闭资源
            rs.close();
            stmt.close();
            connection.close();
            return result;
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;
    }
```

- 执行查询语句 `ResultSet rs = stmt.executeQuery(sql)` 需要遍历ResultSet得到键值对集合，可以进行封装利用泛型转换成需要的类型数据集合
- 执行增删改语句`stmt.execute(sql)`,这个方法返回boolean值，并不是表示语句是否执行成功的，而是表示结果是否是ResultSet
- 每次数据库操作都要写数据库语句，比较麻烦，可以封装一套简单的数据库操作框架

#### 4. 返回数据结构
  一般接口返回Json格式的数据，可以进行简单封装，返回固定格式

#### 5. 完整(封装完成后的)方法实例
```
    @RequestMapping(value = "/login", method = RequestMethod.POST)
    @ResponseBody
    public String login(String account, String password) {
        if (account == null || account.equals("")) {
            return JsonUtils.fail("用户名不能为空");
        }
        if (password == null || password.equals("")) {
            return JsonUtils.fail("密码不能为空");
        }

        User user = UserDao.find(account, password);//密码加密
        if (user == null) {
            return JsonUtils.fail("用户不存在或密码不正确");
        }
        return JsonUtils.success("登录成功", user);
    }
```

用postman请求测试一下
![](/img/postman_login.jpg)



Demo地址：[(https://github.com/Edward-yfbx/SpringDemo)](https://github.com/Edward-yfbx/SpringDemo)

